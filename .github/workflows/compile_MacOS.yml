# Step 9: Build the macOS app (enhanced)
      - name: Build macOS app
        run: |
          set -o pipefail
          
          echo "üèóÔ∏è Starting macOS build process..."
          echo "Scheme: ${{ env.SCHEME_NAME }}"
          echo "Target: ${{ env.TARGET_NAME }}"
          
          # Get the project file
          XCODEPROJ=$(find . -name "*.xcodeproj" -type d | head -n 1)
          echo "Project: $XCODEPROJ"
          
          # Show build settings to debug
          echo "üîç Build settings verification:"
          xcodebuild -showBuildSettings \
            -scheme "${{ env.SCHEME_NAME }}" \
            -project "$XCODEPROJ" \
            -sdk macosx \
            | grep -E "(SUPPORTED_PLATFORMS|PRODUCT_NAME|WRAPPER_EXTENSION|SDKROOT)" | head -5
          
          echo ""
          echo "üöÄ Starting build..."
          
          xcodebuild build \
            -scheme "${{ env.SCHEME_NAME }}" \
            -project "$XCODEPROJ" \
            -sdk macosx \
            -configuration Release \
            -destination "platform=macOS,arch=arm64" \
            -derivedDataPath "${{ env.BUILD_PATH }}/DerivedData" \
            ONLY_ACTIVE_ARCH=NO \
            CODE_SIGN_IDENTITY="" \
            CODE_SIGNING_REQUIRED=NO \
            CODE_SIGNING_ALLOWED=NO \
            SUPPORTED_PLATFORMS=macosx \
            PRODUCT_BUNDLE_IDENTIFIER=com.yourcompany.bitchat.macos \
            | xcpretty || exit 1
          
          echo "‚úÖ Build completed successfully"
          
          # Debug: Show what was built
          echo ""
          echo "üì¶ Build products:"
          find "${{ env.BUILD_PATH }}/DerivedData" -name "*.app" -o -name "*.ipa" | head -5
